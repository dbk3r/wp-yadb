function ajaxExecute(a){return jQuery.ajax({url:WPURLS.yadburl+"/functions/dbexecute.php",type:"POST",data:a,async:false,success:function(d,c,b){},error:function(b,d,c){}}).responseText}function close_viewer(){jQuery(".yadb-overlay").fadeOut();jQuery(".topic-viewer").empty()}function addSavedTopic(b){var a=jQuery("<tr class=wp_yadb_row onclick=\"loadTopicContent(this,'"+b.uuid+"')\"; onmouseover=\"rowOver(this,'.5','#dddddd')\"; onmouseout=\"rowOver(this,'1','transparent')\";><td style=text-align:left>"+b.desc+"<br><small>"+b.date+"</small></td><td>"+b.category+"</td><td>"+b.user+"</td><td>0</td><td>0</td><td align=right><small></small></td></tr>");a.hide();jQuery(".wp_yadb_row").first().before(a);a.fadeIn(500)}function wpyadb_save_topic(c,b,f,a,e){if(isEmpty(c)){var h={action:"newTopic",reply:"0",user:b,category:f,desc:a,content:e};var g=ajaxExecute(h);var d=jQuery.parseJSON(g);addSavedTopic(d)}else{var h={action:"updateTopic",yid:c,category:f,content:e};var g=ajaxExecute(h);var d=jQuery.parseJSON(g)}}function pin_topic(a,d,c){if(c=="0"){var e={action:"pinTopic",value:"0",yid:d};retval=ajaxExecute(e);var b=jQuery.parseJSON(retval);jQuery("#pin_button").attr("src",WPURLS.yadburl+"/img/pin-16.png");jQuery("#pin_button").attr("onclick","pin_topic('"+a+"','"+d+"','1')");jQuery("#pin_button").attr("title","pin topic")}else{var e={action:"pinTopic",value:"1",yid:d};retval=ajaxExecute(e);var b=jQuery.parseJSON(retval);jQuery("#pin_button").attr("src",WPURLS.yadburl+"/img/pinned-16.png");jQuery("#pin_button").attr("onclick","pin_topic('"+a+"','"+d+"','0')");jQuery("#pin_button").attr("title","unpin topic")}}function reply_topic(b,c){alert(b+": "+c);var a='<tr><td colspan=6><div id="reply_editor_container"><textarea id="reply_editor" name="reply_editor"></textarea></div></td></tr>';jQuery(jQuery("#"+c)).after(a);init_editor("textarea#reply_editor","200")}function save_topic(b){var a=tinymce.get("wp-yadb_edit-topic");content=a.getContent({format:"raw"});wpyadb_save_topic(b,"",jQuery("#topic_category").text(),"",content);jQuery("#read_btn_set").show();jQuery("#edit_btn_set").hide();jQuery("#btn_reply").show();jQuery("#postTextContainer").html(content)}function cancel_edit_topic(a){jQuery("#read_btn_set").show();jQuery("#edit_btn_set").hide();jQuery("#btn_reply").show();jQuery("#postTextContainer").html(jQuery("#wp-yadb_edit-topic").val())}function edit_topic(a){jQuery("#postTextContainer").html("<textarea id='wp-yadb_edit-topic' name='wp-yadb_edit-topic'>"+jQuery("#postTextContainer").html()+"</textarea>");jQuery("#read_btn_set").hide();jQuery("#edit_btn_set").show();jQuery("#btn_reply").hide();tinymce.remove("textarea#wp-yadb_edit-topic");init_editor("textarea#wp-yadb_edit-topic","200")}function init_editor(b,a){tinymce.init({selector:b,height:a,menubar:false,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern imagetools codesample"],toolbar:"insertfile undo redo | bold italic | forecolor backcolor | emoticons | alignleft aligncenter alignright alignjustify |  bullist numlist outdent indent | link image media | codesample"})}function delete_topic(d,b,a){if(confirm("do you realy want to delete this topic?")){var e={action:"deleteTopic",yadb_id:d,reply:b,uuid:a};retval=ajaxExecute(e);var c=jQuery.parseJSON(retval);jQuery(".yadb-overlay").fadeOut();jQuery(".topic-viewer").empty();jQuery("#"+d).remove()}}function loadTopicContent(b,a){jQuery(".wpyadb_new_Topic_Header").hide();jQuery(".wpyadb_Editor").slideUp();jQuery(".wpyadb_menu_save").hide();jQuery(".wpyadb_menu_new").show();close_viewer();if(jQuery("."+a).length){jQuery("."+a).fadeOut("slow").remove()}else{var c={content:"topic",uuid:a};jQuery.ajax({type:"POST",url:WPURLS.yadburl+"/functions/dynload.php",data:c,beforeSend:function(d){jQuery(".loader-image").hide().fadeIn()},success:function(d){jQuery(".loader-image").fadeOut();if(d.trim().length==0){jQuery(".loader-image").fadeOut()}jQuery(".topic-viewer").append(d).niceScroll();rowOver(b,"1","transparent");jQuery(".yadb-overlay").fadeIn()}})}}function rowOver(b,c,a){b.style.opacity=c;b.style.background=a}function mbtn_new(){jQuery(".wpyadb_menu").append('<div class="wpyadb_menu_new"><a style="cursor:pointer" class="btn_wpyadb-new-topic" >NEW TOPIC</a></div>')}function mbtn_save(){jQuery(".wpyadb_menu").prepend('<div style="display:none" class="wpyadb_menu_save"><a style="cursor:pointer" class="btn_wpyadb-save-topic" >SAVE TOPIC</a></div>')}function isEmpty(a){return(!a||0===a.length)}jQuery(document).ready(function(){mbtn_new();mbtn_save();var a=1;var c=false;b(a,"topics","","");jQuery(document).on("keyup",function(d){if(d.keyCode==27){close_viewer()}});jQuery(window).scroll(function(){if(jQuery(window).scrollTop()+jQuery(window).height()>=jQuery(document).height()){a++;b(a,"topics","","")}});init_editor("textarea#wp-yadb_new-topic","200");function b(g,d,e,f){if(c==false){c=true;var h={page:g,content:d,uuid:f};jQuery(".loader-image").show();jQuery.ajax({type:"POST",url:WPURLS.yadburl+"/functions/dynload.php",data:h,beforeSend:function(i){jQuery(".loader-image").hide().fadeIn()},success:function(j){c=false;jQuery(".loader-image").fadeOut();if(j.trim().length==0){jQuery(".loader-image").fadeOut();return}var i=jQuery(j);i.hide();if(d=="topics"){jQuery(".wp_yadb_row").last().after(i)}if(d=="topic"){e.last().after(i)}i.fadeIn(500)}})}}jQuery(".btn_wpyadb-new-topic").click(function(){jQuery(".wpyadb_menu_save").show();jQuery(".wpyadb_menu_new").hide();jQuery(".wpyadb_new_Topic_Header").slideDown();jQuery("#wpyadb_topic_desc").val("");var d=tinymce.get("wp-yadb_new-topic");d.setContent("");jQuery(".wpyadb_Editor").slideDown();jQuery("#wpyadb_topic_desc").focus()});jQuery(".btn_wpyadb-save-topic").click(function(){var d=tinymce.get("wp-yadb_new-topic");if(d){content=d.getContent()}else{content=jQuery("#wp-yadb_new-topic").val()}if(jQuery("#wpyadb_topic_desc").val()&&content){jQuery(".wpyadb_menu_save").hide();jQuery(".wpyadb_menu_new").show();wpyadb_save_topic(jQuery("#wpyadb_uuid").val(),jQuery("#wpyadb_username").val(),jQuery("#wpyadb_category :selected").text(),jQuery("#wpyadb_topic_desc").val(),content);jQuery(".wpyadb_new_Topic_Header").hide();jQuery(".wpyadb_Editor").slideUp()}else{alert("please fill out topic Description and the Topic-Content")}})});